<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="001-create-table-cds_outbox_Messages" author="Soso Janashvili">
        <sql>
            CREATE TABLE cds_outbox_Messages
            (
                id                   UUID NOT NULL,
                timestamp            TIMESTAMP(7),
                target               VARCHAR(255),
                msg                  TEXT,
                attempts             INTEGER DEFAULT 0,
                "PARTITION"          INTEGER DEFAULT 0,
                lastError            TEXT,
                lastAttemptTimestamp TIMESTAMP(7),
                status               VARCHAR(23),
                PRIMARY KEY (id)
            );
        </sql>
        <rollback>
            <sql>
                DROP TABLE cds_outbox_Messages;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="002-create-tables-conferences-and-sessions" author="Soso Janashvili">
        <sql>
            CREATE TABLE conferences
            (
                id          UUID DEFAULT gen_random_uuid(),
                name        VARCHAR(100)  NOT NULL,
                location    VARCHAR(100)  NOT NULL,
                description VARCHAR(1000) NOT NULL,
                start_date  DATE,
                end_date    DATE,

                CONSTRAINT pk_conferences PRIMARY KEY (id)
            );

            CREATE TABLE sessions
            (
                id            UUID DEFAULT gen_random_uuid(),
                title         VARCHAR(100) NOT NULL,
                speaker       VARCHAR(100) NOT NULL,
                start_time    TIME,
                end_time      TIME,
                conference_id UUID,

                CONSTRAINT pk_sessions PRIMARY KEY (id),
                CONSTRAINT fk_sessions_conference_id FOREIGN KEY (conference_id) REFERENCES conferences (id)
            );
        </sql>
        <rollback>
            <sql>
                DROP TABLE sessions;
                DROP TABLE conferences;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="003-create-tables-sponsor-and-junction" author="Soso Janashvili">
        <sql>
            CREATE TYPE sponsorship_level_enum AS ENUM (
                'STANDARD',
                'PREMIUM'
            );

            CREATE TABLE sponsors
            (
                id                UUID DEFAULT gen_random_uuid(),
                name              VARCHAR(100)           NOT NULL,
                sponsorship_level sponsorship_level_enum NOT NULL,

                CONSTRAINT pk_sponsors PRIMARY KEY (id)
            );

            CREATE TABLE m2m_conferences_sponsors
            (
                conference_id UUID NOT NULL,
                sponsor_id    UUID NOT NULL,

                CONSTRAINT pk_m2m_conferences_sponsors PRIMARY KEY (conference_id, sponsor_id),
                CONSTRAINT fk_m2m_conferences_sponsors_conference_id__conferences_id FOREIGN KEY (conference_id) REFERENCES conferences (id),
                CONSTRAINT fk_m2m_conferences_sponsors_sponsor_id__sponsors_id FOREIGN KEY (sponsor_id) REFERENCES sponsors (id)
            );
        </sql>
        <rollback>
            <sql>
                DROP TABLE m2m_conferences_sponsors;
                DROP TABLE sponsors;
                DROP TYPE sponsorship_level_enum;
            </sql>
        </rollback>
    </changeSet>

</databaseChangeLog>
